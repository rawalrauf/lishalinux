#!/bin/bash

set -e

trap 'echo ""; echo -e "\033[0;31mSomething went wrong during the update!\n\nPlease review the output above carefully, fix the issue, and retry the update.\n\nOtherwise, please report the issue at https://github.com/rawalrauf/lishalinux/issues\033[0m"' ERR

if [[ $1 == "-y" ]] || lishalinux-update-confirm; then

  # Create pre-update important snapshot
  PRE_SNAP=$(sudo snapper -c root create -c number -d "Pre-update important snapshot" --print-number)
  sudo snapper -c root modify --userdata "important=yes" $PRE_SNAP
  echo -e "\e[32mPre-update snapshot created: $PRE_SNAP\e[0m\n"

  lishalinux-update-perform
fi
